  resources:
    - name: mygitAppRepo
      type: GitRepo
      configuration:
          gitProvider: AnupsGitHub
          path: anupteal/quickstart-jfrog-artifactory
          branches:
             include: 7.11.2
  pipelines:
     - name: anup_taskcat_testing
       configuration:
         environmentVariables:
            readOnly:
               MY_MESSAGE: '"Hello World!"'
               ACCESS_KEY: ${int_anupgeneric_aws_access_key_id}
               SECRET_KEY: ${int_anupgeneric_aws_secret_access_key}
               region: "us-east-2"

       steps:
         - name: step_1
           type: Bash
           configuration:
              runtime:
                 type: image
                 image:
                   custom:
                     name: partnership-public-images.jfrog.io/cft/taskcat
                     tag: "latest"
                     registry: anupdocker
              inputResources:
                   - name: mygitAppRepo
           execution:
              onExecute:
                - echo $ACCESS_KEY $SECRET_KEY
                - export aws_access_key_id=$ACCESS_KEY
                - export aws_secret_access_key=$SECRET_KEY
                - echo "Running $pipeline_name | $step_name on node ID $step_node_id"
                - taskcat --version
                - git --version
                - ls dependencyState/resources/mygitAppRepo/submodules/quickstart-aws-vpc/
                - cd dependencyState/resources/mygitAppRepo/submodules; pwd; rm -rf quickstart-aws-vpc; git clone https://github.com/aws-quickstart/quickstart-aws-vpc.git;  while [ ! -f quickstart-aws-vpc/templates/aws-vpc.template  ]; do sleep 2 ; done
                - pwd; ls quickstart-aws-vpc/templates/aws-vpc.template 
                - cd ../; pwd
                - taskcat test run -n -l
               
